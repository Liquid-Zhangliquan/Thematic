/*!
 * maptalks.webgl v0.3.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function r(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function n(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],h=e[6],u=e[7],f=e[8],c=e[9],p=e[10],v=e[11],y=e[12],g=e[13],d=e[14],_=e[15],x=r[0],m=r[1],b=r[2],A=r[3];return t[0]=x*n+m*s+b*f+A*y,t[1]=x*i+m*l+b*c+A*g,t[2]=x*a+m*h+b*p+A*d,t[3]=x*o+m*u+b*v+A*_,x=r[4],m=r[5],b=r[6],A=r[7],t[4]=x*n+m*s+b*f+A*y,t[5]=x*i+m*l+b*c+A*g,t[6]=x*a+m*h+b*p+A*d,t[7]=x*o+m*u+b*v+A*_,x=r[8],m=r[9],b=r[10],A=r[11],t[8]=x*n+m*s+b*f+A*y,t[9]=x*i+m*l+b*c+A*g,t[10]=x*a+m*h+b*p+A*d,t[11]=x*o+m*u+b*v+A*_,x=r[12],m=r[13],b=r[14],A=r[15],t[12]=x*n+m*s+b*f+A*y,t[13]=x*i+m*l+b*c+A*g,t[14]=x*a+m*h+b*p+A*d,t[15]=x*o+m*u+b*v+A*_,t}function s(t,e,r){var n,i,a,o,s,l,h,u,f,c,p,v,y=r[0],g=r[1],d=r[2];return e===t?(t[12]=e[0]*y+e[4]*g+e[8]*d+e[12],t[13]=e[1]*y+e[5]*g+e[9]*d+e[13],t[14]=e[2]*y+e[6]*g+e[10]*d+e[14],t[15]=e[3]*y+e[7]*g+e[11]*d+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],h=e[6],u=e[7],f=e[8],c=e[9],p=e[10],v=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=l,t[6]=h,t[7]=u,t[8]=f,t[9]=c,t[10]=p,t[11]=v,t[12]=n*y+s*g+f*d+e[12],t[13]=i*y+l*g+c*d+e[13],t[14]=a*y+h*g+p*d+e[14],t[15]=o*y+u*g+v*d+e[15]),t}function l(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function h(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],l=e[7],h=e[8],u=e[9],f=e[10],c=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+h*n,t[5]=o*i+u*n,t[6]=s*i+f*n,t[7]=l*i+c*n,t[8]=h*i-a*n,t[9]=u*i-o*n,t[10]=f*i-s*n,t[11]=c*i-l*n,t}function u(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],l=e[3],h=e[4],u=e[5],f=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+h*n,t[1]=o*i+u*n,t[2]=s*i+f*n,t[3]=l*i+c*n,t[4]=h*i-a*n,t[5]=u*i-o*n,t[6]=f*i-s*n,t[7]=c*i-l*n,t}function f(t,e,r,n,i){var a=1/Math.tan(e/2),o=1/(n-i);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*o,t[15]=0,t}function c(t,e,r,n){var i,o,s,l,h,u,f,c,p,v,y=e[0],g=e[1],d=e[2],_=n[0],x=n[1],m=n[2],b=r[0],A=r[1],w=r[2];return 0===Math.abs(y-b)&&0===Math.abs(g-A)&&0===Math.abs(d-w)?a(t):(f=y-b,c=g-A,p=d-w,v=1/Math.sqrt(f*f+c*c+p*p),f*=v,c*=v,p*=v,i=x*p-m*c,o=m*f-_*p,s=_*c-x*f,v=Math.sqrt(i*i+o*o+s*s),v?(v=1/v,i*=v,o*=v,s*=v):(i=0,o=0,s=0),l=c*s-p*o,h=p*i-f*s,u=f*o-c*i,v=Math.sqrt(l*l+h*h+u*u),v?(v=1/v,l*=v,h*=v,u*=v):(l=0,h=0,u=0),t[0]=i,t[1]=l,t[2]=f,t[3]=0,t[4]=o,t[5]=h,t[6]=c,t[7]=0,t[8]=s,t[9]=u,t[10]=p,t[11]=0,t[12]=-(i*y+o*g+s*d),t[13]=-(l*y+h*g+u*d),t[14]=-(f*y+c*g+p*d),t[15]=1,t)}function p(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}function v(t,e,r){var n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=r,n}function y(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t}function g(){var t=new Float32Array(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function d(){var t=new Float32Array(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function _(){var t=new Float32Array(2);return t[0]=0,t[1]=0,t}function x(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(e,i);a&&a.configurable&&void 0===t[i]&&Object.defineProperty(t,i,a)}return t}function m(t){return t.getMaxNativeZoom()/2}function b(t,e){this.x=t,this.y=e}function A(t,e,r){r=r||2;var n=e&&e.length,i=n?e[0]*r:t.length,a=w(t,0,i,r,!0),o=[];if(!a)return o;var s,l,h,u,f,c,p;if(n&&(a=F(t,e,a,r)),t.length>80*r){s=h=t[0],l=u=t[1];for(var v=r;v<i;v+=r)f=t[v],c=t[v+1],f<s&&(s=f),c<l&&(l=c),f>h&&(h=f),c>u&&(u=c);p=Math.max(h-s,u-l)}return E(a,o,r,s,l,p),o}function w(t,e,r,n,i){var a,o;if(i===K(t,e,r,n)>0)for(a=e;a<r;a+=n)o=G(a,t[a],t[a+1],o);else for(a=r-n;a>=e;a-=n)o=G(a,t[a],t[a+1],o);return o&&z(o,o.next)&&(J(o),o=o.next),o}function S(t,e){if(!t)return t;e||(e=t);var r,n=t;do if(r=!1,n.steiner||!z(n,n.next)&&0!==V(n.prev,n,n.next))n=n.next;else{if(J(n),n=e=n.prev,n===n.next)return null;r=!0}while(r||n!==e);return e}function E(t,e,r,n,i,a,o){if(t){!o&&a&&L(t,n,i,a);for(var s,l,h=t;t.prev!==t.next;)if(s=t.prev,l=t.next,a?R(t,n,i,a):M(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),J(t),t=l.next,h=l.next;else if(t=l,t===h){o?1===o?(t=C(t,e,r),E(t,e,r,n,i,a,2)):2===o&&B(t,e,r,n,i,a):E(S(t),e,r,n,i,a,1);break}}}function M(t){var e=t.prev,r=t,n=t.next;if(V(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(O(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&V(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function R(t,e,r,n){var i=t.prev,a=t,o=t.next;if(V(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,h=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,f=D(s,l,e,r,n),c=D(h,u,e,r,n),p=t.nextZ;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&O(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&V(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=f;){if(p!==t.prev&&p!==t.next&&O(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&V(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function C(t,e,r){var n=t;do{var i=n.prev,a=n.next.next;!z(i,a)&&j(i,n,n.next,a)&&Z(i,a)&&Z(a,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(a.i/r),J(n),J(n.next),n=t=a),n=n.next}while(n!==t);return n}function B(t,e,r,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&I(o,s)){var l=W(o,s);return o=S(o,o.next),l=S(l,l.next),E(o,e,r,n,i,a),void E(l,e,r,n,i,a)}s=s.next}o=o.next}while(o!==t)}function F(t,e,r,n){var i,a,o,s,l,h=[];for(i=0,a=e.length;i<a;i++)o=e[i]*n,s=i<a-1?e[i+1]*n:t.length,l=w(t,o,s,n,!1),l===l.next&&(l.steiner=!0),h.push(N(l));for(h.sort(T),i=0;i<h.length;i++)k(h[i],r),r=S(r,r.next);return r}function T(t,e){return t.x-e.x}function k(t,e){if(e=P(t,e)){var r=W(e,t);S(r,r.next)}}function P(t,e){var r,n=e,i=t.x,a=t.y,o=-(1/0);do{if(a<=n.y&&a>=n.next.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===o)return r.prev;var l,h=r,u=r.x,f=r.y,c=1/0;for(n=r.next;n!==h;)i>=n.x&&n.x>=u&&O(a<f?i:o,a,u,f,a<f?o:i,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(i-n.x),(l<c||l===c&&n.x>r.x)&&Z(n,t)&&(r=n,c=l)),n=n.next;return r}function L(t,e,r,n){var i=t;do null===i.z&&(i.z=D(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,U(i)}function U(t){var e,r,n,i,a,o,s,l,h=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,n=r,s=0,e=0;e<h&&(s++,n=n.nextZ,n);e++);for(l=h;s>0||l>0&&n;)0===s?(i=n,n=n.nextZ,l--):0!==l&&n?r.z<=n.z?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--):(i=r,r=r.nextZ,s--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=n}a.nextZ=null,h*=2}while(o>1);return t}function D(t,e,r,n,i){return t=32767*(t-r)/i,e=32767*(e-n)/i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function N(t){var e=t,r=t;do e.x<r.x&&(r=e),e=e.next;while(e!==t);return r}function O(t,e,r,n,i,a,o,s){return(i-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function I(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Y(t,e)&&Z(t,e)&&Z(e,t)&&q(t,e)}function V(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function z(t,e){return t.x===e.x&&t.y===e.y}function j(t,e,r,n){return!!(z(t,e)&&z(r,n)||z(t,n)&&z(r,e))||V(t,e,r)>0!=V(t,e,n)>0&&V(r,n,t)>0!=V(r,n,e)>0}function Y(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&j(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Z(t,e){return V(t.prev,t,t.next)<0?V(t,e,t.next)>=0&&V(t,t.prev,e)>=0:V(t,e,t.prev)<0||V(t,t.next,e)<0}function q(t,e){var r=t,n=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do r.y>a!=r.next.y>a&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==t);return n}function W(t,e){var r=new H(t.i,t.x,t.y),n=new H(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function G(t,e,r,n){var i=new H(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function J(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function H(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function K(t,e,r,n){for(var i=0,a=e,o=r-n;a<r;a+=n)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}function X(t,e,r,n,i,a){if(!(i-n<=r)){var o=Math.floor((n+i)/2);$(t,e,o,n,i,a%2),X(t,e,r,n,o-1,a+1),X(t,e,r,o+1,i,a+1)}}function $(t,e,r,n,i,a){for(;i>n;){if(i-n>600){var o=i-n+1,s=r-n+1,l=Math.log(o),h=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*h*(o-h)/o)*(s-o/2<0?-1:1),f=Math.max(n,Math.floor(r-s*h/o+u)),c=Math.min(i,Math.floor(r+(o-s)*h/o+u));$(t,e,r,f,c,a)}var p=e[2*r+a],v=n,y=i;for(Q(t,e,n,r),e[2*i+a]>p&&Q(t,e,n,i);v<y;){for(Q(t,e,v,y),v++,y--;e[2*v+a]<p;)v++;for(;e[2*y+a]>p;)y--}e[2*n+a]===p?Q(t,e,n,y):(y++,Q(t,e,y,i)),y<=r&&(n=y+1),r<=y&&(i=y-1)}}function Q(t,e,r,n){tt(t,r,n),tt(e,2*r,2*n),tt(e,2*r+1,2*n+1)}function tt(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function et(t,e,r,n,i,a,o){for(var s,l,h=[0,t.length-1,0],u=[];h.length;){var f=h.pop(),c=h.pop(),p=h.pop();if(c-p<=o)for(var v=p;v<=c;v++)s=e[2*v],l=e[2*v+1],s>=r&&s<=i&&l>=n&&l<=a&&u.push(t[v]);else{var y=Math.floor((p+c)/2);s=e[2*y],l=e[2*y+1],s>=r&&s<=i&&l>=n&&l<=a&&u.push(t[y]);var g=(f+1)%2;(0===f?r<=s:n<=l)&&(h.push(p),h.push(y-1),h.push(g)),(0===f?i>=s:a>=l)&&(h.push(y+1),h.push(c),h.push(g))}}return u}function rt(t,e,r,n,i,a){for(var o=[0,t.length-1,0],s=[],l=i*i;o.length;){var h=o.pop(),u=o.pop(),f=o.pop();if(u-f<=a)for(var c=f;c<=u;c++)nt(e[2*c],e[2*c+1],r,n)<=l&&s.push(t[c]);else{var p=Math.floor((f+u)/2),v=e[2*p],y=e[2*p+1];nt(v,y,r,n)<=l&&s.push(t[p]);var g=(h+1)%2;(0===h?r-i<=v:n-i<=y)&&(o.push(f),o.push(p-1),o.push(g)),(0===h?r+i>=v:n+i>=y)&&(o.push(p+1),o.push(u),o.push(g))}}return s}function nt(t,e,r,n){var i=t-r,a=e-n;return i*i+a*a}function it(t,e,r,n,i){return new at(t,e,r,n,i)}function at(t,e,r,n,i){e=e||ot,r=r||st,i=i||Array,this.nodeSize=n||64,this.points=t,this.ids=new i(t.length),this.coords=new i(2*t.length);for(var a=0;a<t.length;a++)this.ids[a]=a,this.coords[2*a]=e(t[a]),this.coords[2*a+1]=r(t[a]);le(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function ot(t){return t[0]}function st(t){return t[1]}function lt(t,e){return e={exports:{}},t(e,e.exports),e.exports}function ht(){for(var t={},e=_e.length,r=0;r<e;r++)t[_e[r]]={distance:-1,parent:null};return t}function ut(t){var e=ht(),r=[t];for(e[t].distance=0;r.length;)for(var n=r.pop(),i=Object.keys(de[n]),a=i.length,o=0;o<a;o++){var s=i[o],l=e[s];l.distance===-1&&(l.distance=e[n].distance+1,l.parent=n,r.unshift(s))}return e}function ft(t,e){return function(r){return e(t(r))}}function ct(t,e){for(var r=[e[t].parent,t],n=de[e[t].parent][t],i=e[t].parent;e[i].parent;)r.unshift(e[i].parent),n=ft(de[e[i].parent][i],n),i=e[i].parent;return n.conversion=r,n}function pt(t){var e=function(e){return void 0===e||null===e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function vt(t){var e=function(e){if(void 0===e||null===e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var r=t(e);if("object"===("undefined"==typeof r?"undefined":kt(r)))for(var n=r.length,i=0;i<n;i++)r[i]=Math.round(r[i]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}function yt(t){if(t){var e=/^#([a-fA-F0-9]{3})$/,r=/^#([a-fA-F0-9]{6})$/,n=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,i=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,a=/(\D+)/,o=[0,0,0],s=1,l=t.match(e);if(l){l=l[1];for(var h=0;h<o.length;h++)o[h]=parseInt(l[h]+l[h],16)}else if(l=t.match(r)){l=l[1];for(var h=0;h<o.length;h++)o[h]=parseInt(l.slice(2*h,2*h+2),16)}else if(l=t.match(n)){for(var h=0;h<o.length;h++)o[h]=parseInt(l[h+1]);s=parseFloat(l[4])}else if(l=t.match(i)){for(var h=0;h<o.length;h++)o[h]=Math.round(2.55*parseFloat(l[h+1]));s=parseFloat(l[4])}else if(l=t.match(a)){if("transparent"==l[1])return[0,0,0,0];if(o=Ee[l[1]],!o)return}for(var h=0;h<o.length;h++)o[h]=Ft(o[h],0,255);return s=s||0==s?Ft(s,0,1):1,o[3]=s,o}}function gt(t){if(t){var e=/^hsla?\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var n=parseFloat(r[4]),i=Ft(parseInt(r[1]),0,360),a=Ft(parseFloat(r[2]),0,100),o=Ft(parseFloat(r[3]),0,100),s=Ft(isNaN(n)?1:n,0,1);return[i,a,o,s]}}}function dt(t){if(t){var e=/^hwb\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var n=parseFloat(r[4]),i=Ft(parseInt(r[1]),0,360),a=Ft(parseFloat(r[2]),0,100),o=Ft(parseFloat(r[3]),0,100),s=Ft(isNaN(n)?1:n,0,1);return[i,a,o,s]}}}function _t(t){var e=yt(t);return e&&e.slice(0,3)}function xt(t){var e=gt(t);return e&&e.slice(0,3)}function mt(t){var e=yt(t);return e?e[3]:(e=gt(t))?e[3]:(e=dt(t))?e[3]:void 0}function bt(t){return"#"+Tt(t[0])+Tt(t[1])+Tt(t[2])}function At(t,e){return e<1||t[3]&&t[3]<1?wt(t,e):"rgb("+t[0]+", "+t[1]+", "+t[2]+")"}function wt(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function St(t,e){if(e<1||t[3]&&t[3]<1)return Et(t,e);var r=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),i=Math.round(t[2]/255*100);return"rgb("+r+"%, "+n+"%, "+i+"%)"}function Et(t,e){var r=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),i=Math.round(t[2]/255*100);return"rgba("+r+"%, "+n+"%, "+i+"%, "+(e||t[3]||1)+")"}function Mt(t,e){return e<1||t[3]&&t[3]<1?Rt(t,e):"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)"}function Rt(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+e+")"}function Ct(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+(void 0!==e&&1!==e?", "+e:"")+")"}function Bt(t){return Re[t.slice(0,3)]}function Ft(t,e,r){return Math.min(Math.max(e,t),r)}function Tt(t){var e=t.toString(16).toUpperCase();return e.length<2?"0"+e:e}var kt=(p(),g(),p(),v(1,0,0),v(0,1,0),r(),d(),d(),_(),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}),Pt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Lt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):x(t,e))},Ut=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Dt=function(t){function e(r,n,i){Pt(this,e);var a=Ut(this,t.call(this,i));return a.gl=r,a.map=n,a}return Lt(e,t),e}(e.Class),Nt=Math.PI/180,Ot=function(t){function r(){return Pt(this,r),Ut(this,t.apply(this,arguments))}return Lt(r,t),r.prototype.needToRedraw=function(){var e=this.getMap();return!(e.isZooming()&&!e.getPitch())&&t.prototype.needToRedraw.call(this)},r.prototype.createCanvas=function(){if(!this.canvas){var t=this.getMap(),r=t.getSize(),n=e.Browser.retina?2:1;this.canvas=e.Canvas.createCanvas(n*r.width,n*r.height,t.CanvasClass);var i=this.gl=this._createGLContext(this.canvas,this.layer.options.glOptions);i.clearColor(0,0,0,0),i.verbose=!0,i.blendFunc(i.ONE,i.ONE),i.enable(i.BLEND),i.disable(i.DEPTH_TEST),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.onCanvasCreate&&this.onCanvasCreate(),this.layer.options.doubleBuffer&&(this.buffer=e.Canvas.createCanvas(this.canvas.width,this.canvas.height,t.CanvasClass),this.context=this.buffer.getContext("2d"))}},r.prototype.resizeCanvas=function(t){if(this.canvas){var r=void 0;r=t?t:this.getMap().getSize();var n=e.Browser.retina?2:1;this.canvas.height=n*r.height,this.canvas.width=n*r.width,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}},r.prototype.clearCanvas=function(){this.canvas&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.context&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height))},r.prototype.prepareCanvas=function(){return this.context?t.prototype.prepareCanvas.call(this):(this.canvas?this.clearCanvas():this.createCanvas(),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null)},r.prototype.mergeSprites=function(t,r){if(!t||0===t.length)return null;var n=2,i=0,a=0;t.forEach(function(t){if(r){var e=Math.max(t.canvas.width,t.canvas.height);i+=e+n,e>a&&(a=e)}else i+=t.canvas.width+n,t.canvas.height>a&&(a=t.canvas.height)}),i=Math.pow(2,Math.ceil(Math.log(i)/Math.LN2)),a=Math.pow(2,Math.ceil(Math.log(a)/Math.LN2));var o=this.getMap(),s=e.Canvas.createCanvas(i,a,o.CanvasClass),l=s.getContext("2d"),h=[],u=[],f=[],c=0;t.forEach(function(t){var e=0,o=0,s=void 0;if(r){var p=t.canvas.width,v=t.canvas.height;s=Math.max(p,v),e=s>p?(s-p)/2:0,o=s>v?(s-v)/2:0,h.push([c/i,s/i,s/a,s]),f.push([p,v])}else s=t.canvas.width,h.push([c/i,t.canvas.width/i,t.canvas.height/a]);l.drawImage(t.canvas,c+e,o),u.push(t.offset),c+=s+n});var p={canvas:s,texCoords:h,offsets:u};return r&&(p.sizes=f),p},r.prototype.createBuffer=function(){var t=this.gl,e=t.createBuffer();if(!e)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(e),e},r.prototype.enableVertexAttrib=function(t){var e=this.gl;if(Array.isArray(t[0])){for(var r=new Float32Array([0,0,0]),n=r.BYTES_PER_ELEMENT,i=0,a=0;a<t.length;a++)i+=t[a][1]||0;for(var o=0,s=0;s<t.length;s++){var l=e.getAttribLocation(e.program,t[s][0]);if(l<0)throw new Error("Failed to get the storage location of "+t[s][0]);e.vertexAttribPointer(l,t[s][1],e[t[s][2]||"FLOAT"],!1,n*i,n*o),o+=t[s][1]||0,e.enableVertexAttribArray(l)}}else{var h=e.getAttribLocation(e.program,t[0]);e.vertexAttribPointer(h,t[1],e[t[2]||"FLOAT"],!1,0,0),e.enableVertexAttribArray(h)}},r.prototype.onRemove=function(){var t=this.gl;this._buffers&&(this._buffers.forEach(function(e){t.deleteBuffer(e)}),delete this._buffers)},r.prototype.createProgram=function(t,e,r){var n=this.gl,i=this._compileShader(n,n.VERTEX_SHADER,t),a=this._compileShader(n,n.FRAGMENT_SHADER,e);if(!i||!a)return null;var o=n.createProgram();if(!o)return null;n.attachShader(o,i),n.attachShader(o,a),n.linkProgram(o);var s=n.getProgramParameter(o,n.LINK_STATUS);if(!s){var l=n.getProgramInfoLog(o);throw n.deleteProgram(o),n.deleteShader(a),n.deleteShader(i),new Error("Failed to link program: "+l)}return this._initUniforms(o,r),o},r.prototype.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},r.prototype.loadTexture=function(t,e){var r=this.gl,n=r.createTexture();if(!n)throw new Error("Failed to create the texture object");return e||(e=0),r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),n},r.prototype.enableSampler=function(t,e){var r=this.gl,n=this._getUniform(r.program,t);return e||(e=0),r.uniform1i(n,e),n},r.prototype._calcMatrices=function(){var t=this.getMap(),r=t.getSize(),i=t.getScale(),a=t._prjToPoint(t._getPrjCenter(),t.getMaxZoom()),o=t.getFov()*Math.PI/180,c=.5/Math.tan(o/2)*r.height*i,p=n();return f(p,o,r.width/r.height,1,c+1e9),e.Util.isNode||l(p,p,[1,-1,1]),s(p,p,[0,0,-c]),h(p,p,t.getPitch()*Math.PI/180),u(p,p,-t.getBearing()*Math.PI/180),s(p,p,[-a.x,-a.y,0]),p},r.prototype.calcMatrices=function(){var t=this.getMap(),r=t.getSize(),a=t.getFov()*Math.PI/180,s=t.getScale(t.getMinZoom())/t.getScale(t.getMaxNativeZoom()),h=s*r.height/2/this._getFovRatio(),u=n();f(u,a,r.width/r.height,1,h);var c=n();e.Util.isNode||l(u,u,[1,-1,1]),i(c,u);var p=this._getLookAtMat();return o(u,c,p),u},r.prototype._getLookAtMat=function(){var t=this.getMap(),e=m(t),r=t.getSize(),i=t.getScale()/t.getScale(e),a=this.cameraCenter=t.coordinateToPoint(t.getCenter(),e),o=t.getPitch()*Nt,s=-t.getBearing()*Nt,l=this._getFovRatio(),h=i*r.height/2/l,u=h*Math.cos(o),f=Math.sin(o)*h,p=a.x+f*Math.sin(s),v=a.y+f*Math.cos(s),y=[Math.sin(s),Math.cos(s),0],g=n();return c(g,[p,v,u],[a.x,a.y,0],y),g},r.prototype._getFovRatio=function(){var t=this.getMap(),e=t.getFov();return Math.tan(e/2*Math.PI/180)},r.prototype.hitDetect=function(t){var e=this.gl;if(!e)return!1;var r=new Uint8Array(4),n=this.getMap(),i=this.canvas.height,a=n._pointToContainerPoint(t)._round();return e.readPixels(a.x,i-a.y,1,1,e.RGBA,e.UNSIGNED_BYTE,r),r[3]>0},r.prototype.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.buffer){var r=e.image;this.buffer.width===r.width&&this.buffer.height===r.height&&this._preserveBuffer||(this.buffer.width=r.width,this.buffer.height=r.height),this._preserveBuffer||this.context.drawImage(r,0,0),e.image=this.buffer}return e},r.prototype.onZoomStart=function(){t.prototype.onZoomStart.apply(this,arguments)},r.prototype.onZoomEnd=function(){t.prototype.onZoomEnd.apply(this,arguments)},r.prototype._createGLContext=function(t,r){for(var n=e.Util.extend({alpha:!0,antialias:!0,preserveDrawingBuffer:!0},r),i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],a=null,o=0;o<i.length;++o){try{a=t.getContext(i[o],n)}catch(t){}if(a)break}return a},r.prototype._compileShader=function(t,e,r){var n=t.createShader(e);if(null==n)throw new Error("unable to create shader");t.shaderSource(n,r),t.compileShader(n);var i=t.getShaderParameter(n,t.COMPILE_STATUS);if(!i){var a=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error("Failed to compile shader: "+a)}return n},r.prototype._initUniforms=function(t,r){for(var n=0;n<r.length;n++){var i=r[n],a=r[n],o=i.indexOf("[");o>=0&&(i=i.substring(0,o),e.Util.isNode||(a=a.substring(0,o))),t[i]=this._getUniform(t,a)}},r.prototype._getUniform=function(t,e){var r=this.gl,n=r.getUniformLocation(t,e);if(!n)throw new Error("Failed to get the storage location of "+e);return n},r}(e.renderer.CanvasRenderer),It=function(){function t(e,r){Pt(this,t),this.resources=e,this.options=r||{},this.atlas={}}return t.prototype.getAtlas=function(t){var e=JSON.stringify(t);if(!this.atlas[e]){var r=this.addAtlas(t);r&&(this.atlas[e]=r)}return this.atlas[e]},t.prototype.addAtlas=function(t){if(!t.lineDasharray&&!t.linePatternFile)return null;var r=this._getSize(t,this.resources),n=this._createCanvas(r);if(!n)throw new Error("can not initialize canvas container.");var i=n.getContext("2d");return e.Canvas.prepareCanvas(i,t,this.resources),i.moveTo(0,r[1]/2),i.lineTo(r[0],r[1]/2),i.stroke(),{canvas:n,offset:new e.Point(0,0)}},t.prototype._getSize=function(t,e){var r=0,n=0,i=t.lineDasharray;if(i){for(var a=0;a<i.length;a++)r+=i[a];i.length%2===1&&(r*=2),n=null==t.lineWidth?2:t.lineWidth}if(t.linePatternFile){var o=e.getImage(t.linePatternFile);o.width>r&&(r=o.width),o.height>n&&(n=o.height)}return[r,n]},t.prototype._createCanvas=function(t){if(this.options.canvasClass)return new this.options.canvasClass(t[0],t[1]);if("undefined"!=typeof document){var e=document.createElement("canvas");return e.width=t[0],e.height=t[1],e}return null},t}(),Vt=b;b.prototype={clone:function(){return new b(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,i=r*this.x+e*this.y;return this.x=n,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this.x-e.x)-n*(this.y-e.y),a=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=i,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},b.convert=function(t){return t instanceof b?t:Array.isArray(t)?new b(t[0],t[1]):t};var zt={project:!0},jt=function(t){function r(e,n,i){Pt(this,r);var a=Ut(this,t.call(this,e,n,i));return a.vertexArray=[],a.normalArray=[],a.elementArray=[],a.styleArray=[],a.distance=0,a}return Lt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,normalArray:this.normalArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addLine=function(t,r){if(!t)return this;if(r.symbol.lineWidth<=0||r.symbol.lineOpacity<=0)return this;var n=this.vertexArray.length,i=this._getVertice(t);if(i[0]&&Array.isArray(i[0][0])){for(var a=0,o=i.length;a<o;a++)this.addLine(i[a],r);return this}this._prepareToAdd();for(var s=m(this.map),l=void 0,h=void 0,u=0,f=i.length;u<f;u++){var c=i[u];this.options.project&&(c=this.map.coordinateToPoint(new e.Coordinate(c),s).toArray()),l=Vt.convert(c),u<f-1?(c=i[u+1],this.options.project&&(c=this.map.coordinateToPoint(new e.Coordinate(c),s).toArray()),h=Vt.convert(c)):h=null,this.addCurrentVertex(l,h)}var p=this.vertexArray.length-n;return this._addTexCoords(p,r),this},r.prototype.addCurrentVertex=function(t,e){if(!this.preVertex)return this.e1=this.e2=this.e3=-1,this._waitForLeftCap=!0,void(this.preVertex=t);var r=t.sub(this.preVertex)._unit()._perp()._mult(-1),n=void 0;e&&(n=e.sub(t)._unit()._perp()._mult(-1));var i=this._getStartNormal(r,this.preNormal);if(this._addLineEndVertexs(this.preVertex,i,this.distance),this.distance+=t.dist(this.preVertex),!e){var a=this._getEndNormal(r,n);this._addLineEndVertexs(t,a,this.distance)}this.preNormal=r,this.preVertex=t},r.prototype._prepareToAdd=function(){this.distance=0,delete this.preVertex,delete this.preNormal},r.prototype._addLineEndVertexs=function(t,e,r){var n=e.normal[0];this.e3=this._addVertex(t,n,r),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3,n=e.normal[1],this.e3=this._addVertex(t,n,r),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3},r.prototype._addVertex=function(t,r,n){this.vertexArray.push(t.x,t.y);var i=[this._precise(r.x),this._precise(r.y),n],a=this.normalArray.length/i.length;return e.Util.pushIn(this.normalArray,i),a},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){var r=(e.symbol.lineWidth||2)/2*100+10*(e.symbol.lineOpacity||1);r=1e4*r+e.index;for(var n=0;n<t;n++)this.styleArray.push(r)},r.prototype._getStartNormal=function(t,e){return this._getJoinNormal(t,e,t)},r.prototype._getEndNormal=function(t,e){return this._getJoinNormal(t,t,e)},r.prototype._getJoinNormal=function(t,e,r){if(!e||!r)return{normal:[t,t.mult(-1)]};var n=e.add(r)._unit(),i=n.x*r.x+n.y*r.y,a=1/i;return n._mult(a),{normal:[n,n.mult(-1)]}},r.prototype._precise=function(t){return Math.round(1e7*t)/1e7},r}(Dt);jt.mergeOptions(zt);var Yt=A;A.deviation=function(t,e,r,n){var i=e&&e.length,a=i?e[0]*r:t.length,o=Math.abs(K(t,0,a,r));if(i)for(var s=0,l=e.length;s<l;s++){var h=e[s]*r,u=s<l-1?e[s+1]*r:t.length;o-=Math.abs(K(t,h,u,r))}var f=0;for(s=0;s<n.length;s+=3){var c=n[s]*r,p=n[s+1]*r,v=n[s+2]*r;f+=Math.abs((t[c]-t[v])*(t[p+1]-t[c+1])-(t[c]-t[p])*(t[v+1]-t[c+1]))}return 0===o&&0===f?0:Math.abs((f-o)/o)},A.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var o=0;o<e;o++)r.vertices.push(t[i][a][o]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r};var Zt={project:!0},qt=function(t){function r(e,n,i){Pt(this,r);var a=Ut(this,t.call(this,e,n,i));return a.vertexArray=[],a.elementArray=[],a.styleArray=[],a}return Lt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addPolygon=function(t,r){var n=this;if(!t)return this;if(r.symbol.polygonOpacity<=0)return this;var i=this._getVertice(t);if(i[0]&&Array.isArray(i[0][0])&&Array.isArray(i[0][0][0])){for(var a=0,o=i.length;a<o;a++)this.addPolygon(i[a],r);return this}i.forEach(function(t){t.length&&(n._equalCoord(t[0],t[t.length-1])||t.push(t[0],t[1]))});var s=m(this.map),l=Yt.flatten(i);if(this.options.project){for(var h=[],u=void 0,f=0,c=l.vertices.length;f<c;f+=2)u=this.map.coordinateToPoint(new e.Coordinate(l.vertices[f],l.vertices[f+1]),s),h.push(u.x,u.y);l.vertices=h}var p=Yt(l.vertices,l.holes,2);if(p.length<=2)return this;var v=Yt.deviation(l.vertices,l.holes,2,p);if(Math.round(1e3*v)/1e3!==0)return console&&console.warn("Failed triangluation."),this;var y=this.vertexArray.length/2;return y>0&&(p=p.map(function(t){return t+y})),e.Util.pushIn(this.vertexArray,l.vertices),e.Util.pushIn(this.elementArray,p),this._addTexCoords(l.vertices.length/2,r),this},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){for(var r=100*e.index+10*(e.symbol.polygonOpacity||1),n=0;n<t;n++)this.styleArray.push(r)},r.prototype._equalCoord=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r}(Dt);qt.mergeOptions(Zt);var Wt="#ifdef GL_ES\nprecision mediump float;\n#else\n#define lowp\n#define mediump\n#define highp\n#endif\n\nuniform float u_blur;\nuniform vec2 u_tex_size;\n\n// varying lowp vec4 v_color;\n// varying vec2 v_linenormal;\nvarying vec4 v_texcoord;\nvarying float v_opacity;\nvarying float v_linewidth;\nvarying float v_scale;\nvarying float v_texture_normal;\nvarying float v_linesofar;\n// varying float v_ruler;\n\nuniform sampler2D u_image;\n\nvoid main() {\n    vec4 color;\n    if (v_texcoord.q == -1.0) {\n        // is a texture fragment\n        float linesofar = v_linesofar / v_scale;\n        float texWidth = u_tex_size.x * v_texcoord.t;\n        float x = v_texcoord.s + mod(linesofar, texWidth) / texWidth * v_texcoord.t;\n        float y = (v_texture_normal + 1.0) / 2.0 * v_texcoord.p;\n\n        color = texture2D(u_image, vec2(x, y));\n    } else {\n        // a color fragment\n        color = v_texcoord;\n    }\n    float alpha = 1.0;\n    gl_FragColor = color * (alpha * v_opacity);\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}",Gt=e.Browser.ie||e.Browser.edge?504:e.Util.isNode?1014:240,Jt="#ifdef GL_ES\nprecision highp float;\n#else\n#define lowp\n#define mediump\n#define highp\n#endif\n\nattribute vec4 a_pos;\nattribute mediump vec2 a_normal;\n// attribute mediump vec2 a_linenormal;\nattribute float a_linesofar;\n// (line_width * 100 + opacity * 10) * 10000 + tex_idx\nattribute float a_style;\n// attribute float a_seglen;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\nuniform float u_styles["+Gt+"];\n\nvarying vec2 v_linenormal;\nvarying float v_linewidth;\nvarying float v_opacity;\nvarying vec4 v_texcoord;\nvarying float v_scale;\nvarying float v_texture_normal;\n\nvarying float v_linesofar;\n// varying float v_ruler;\n\nvoid main() {\n    int tex_idx = int(mod(a_style, 10000.0));\n    float s = floor(a_style / 10000.0);\n    v_opacity = mod(s, 10.0) / 10.0;\n    if (v_opacity == 0.0) {\n        v_opacity = 1.0;\n    }\n    v_linewidth = s / 100.0;\n    v_texcoord = vec4(u_styles[tex_idx], u_styles[tex_idx + 1], u_styles[tex_idx + 2], u_styles[tex_idx + 3]);\n\n    v_scale = u_scale;\n\n    // v_linenormal = a_linenormal;\n\n    vec4 pos = a_pos;\n    pos.x += a_normal.x * v_linewidth * u_scale;\n    pos.y += a_normal.y * v_linewidth * u_scale;\n\n    // add linesofar with corner length caused by line-join\n    v_linesofar = a_linesofar;\n\n\n    gl_Position = u_matrix * pos;\n    if (a_normal.y == 0.0) {\n        // with an upside down straight line, a_normal.y is always 0, use a_normal.x instead\n        v_texture_normal = -sign(a_normal.x);\n    } else {\n        //\n        v_texture_normal = sign(a_normal.y);\n    }\n\n}",Ht="\nprecision mediump float;\nuniform sampler2D u_sampler;\nvarying vec3 v_texCoord;\nvoid main() {\n    gl_FragColor = texture2D(u_sampler, vec2(v_texCoord[0] + gl_PointCoord[0] * v_texCoord[1], 1.0 + gl_PointCoord[1] * v_texCoord[2]));\n}",Kt="\n// marker's 2d point at max zoom\nattribute vec4 a_pos;\n// texture idx in u_sprite\nattribute float a_sprite_idx;\nuniform mat4 u_matrix;\n// scale of current zoom\nuniform float u_scale;\n// sprites, an array of sprites\n// a sprite has 6 integers:\n// 0 : northwest's x, 1 : width, 2: height, 3: sprite size, 4: offset x, 5: offset y\n// array's length is not dynamic, support maximum count / 6 sprites\nuniform float u_sprite["+Gt+"];\nvarying vec3 v_texCoord;\nvoid main() {\n  int idx = int(a_sprite_idx) * 6;\n  float size = u_sprite[idx + 3];\n  vec2 textOffset = vec2(u_sprite[idx + 4], u_sprite[idx + 5]);\n  vec4 pos = vec4(a_pos.x + textOffset.x * u_scale, a_pos.y + textOffset.y * u_scale, a_pos.z, a_pos.w);\n  gl_Position = u_matrix * pos;\n  gl_PointSize = size;\n  // texture coord\n  v_texCoord = vec3(u_sprite[idx], u_sprite[idx + 1], u_sprite[idx + 2]);\n}",Xt="\nprecision mediump float;\n\nvarying vec4 v_texcoord;\nvarying float v_opacity;\nvoid main() {\n    gl_FragColor = v_texcoord * v_opacity;\n}",$t="attribute vec4 a_pos;\n//tex_idx * 100 + opacity * 10\nattribute float a_fill_style;\n\nuniform mat4 u_matrix;\nuniform float u_fill_styles["+Gt+"];\n\nvarying float v_opacity;\nvarying vec4 v_texcoord;\n\nvoid main() {\n  int tex_idx = int(floor(a_fill_style / 100.0));\n  v_opacity = mod(a_fill_style, 100.0) / 10.0;\n  v_texcoord = vec4(u_fill_styles[tex_idx], u_fill_styles[tex_idx + 1], u_fill_styles[tex_idx + 2], u_fill_styles[tex_idx + 3]);\n\n  gl_Position = u_matrix * a_pos;\n}",Qt="\nprecision mediump float;\n\nvarying vec4 v_texcoord;\nvarying float v_opacity;\n// varying vec4 v_lighting;\n\nvoid main() {\n    gl_FragColor = v_texcoord * v_opacity;\n}",te="attribute vec4 a_pos;\nattribute vec4 a_normal;\n//tex_idx * 100 + opacity * 10\nattribute float a_fill_style;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp vec3 u_ambientlight;\nuniform lowp float u_lightintensity;\n// uniform vec3 u_ambientlight;\n\nuniform mat4 u_matrix;\nuniform float u_fill_styles["+Gt+"];\n\nvarying float v_opacity;\nvarying vec4 v_texcoord;\n\nvarying vec4 v_lighting;\n\nvoid main() {\n  int tex_idx = int(a_fill_style / 100.0) * 4;\n  v_opacity = mod(a_fill_style, 100.0) / 10.0;\n\n  vec4 color = vec4(u_fill_styles[tex_idx], u_fill_styles[tex_idx + 1], u_fill_styles[tex_idx + 2], u_fill_styles[tex_idx + 3]);\n\n  gl_Position = u_matrix * a_pos;\n\n  vec3 normal = normalize(a_normal.xyz);\n  // // vec3 lightpos = normalize(u_lightpos);\n  // float nDotL = max(dot(u_lightpos, normal), 0.0);\n  // vec3 diffuse = u_lightcolor * color.rgb * nDotL;\n\n  // vec3 ambient = u_ambientlight * color.rgb;\n\n  // v_texcoord = vec4(diffuse + ambient, color.a);\n\n  // Relative luminance (how dark/bright is the surface color?)\n  float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n  // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(u_ambientlight, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(normal, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    // if (normal.y != 0.0) {\n    //     directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    // }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_texcoord.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_texcoord.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_texcoord.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n    v_texcoord.a = color.a;\n  // vec3 normal = normalize(a_normal.xyz);\n  // vec3 lightpos = normalize(u_lightpos.xyz);\n  // // codes from mapbox-gl-js\n  // v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n  // float directional = clamp(dot(normal, lightpos), 0.0, 1.0);\n  // directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n  // // if (a_normal.y != 0.0) {\n  // //   directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n  // // }\n\n  // v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}",ee={
line:{fragmentSource:Wt,vertexSource:Jt},point:{fragmentSource:Ht,vertexSource:Kt},polygon:{fragmentSource:Xt,vertexSource:$t},extrude:{fragmentSource:Qt,vertexSource:te}},re=Object.freeze({WebglRenderer:Ot,Shader:ee,Painter:Dt,LineAtlas:It,LinePainter:jt,PolygonPainter:qt}),ne={renderer:"webgl",doublBuffer:!1,renderOnMoving:!1,renderOnZooming:!1},ie=function(t){function r(n,i,a){Pt(this,r);var o=e.Util.extend({},a),s=void 0;o.style&&(s=o.style,delete o.style);var l=Ut(this,t.call(this,n,o));return l.data=i,s&&l.setStyle(s),l}return Lt(r,t),r.fromJSON=function(t){if(!t||t.type!==this.getJSONType())return null;var e=this.prototype.constructor,r=new e(t.id,t.data,t.options);return t.style&&r.setStyle(t.style),r},r.prototype.toJSON=function(){var t={type:this.getJSONType(),data:this.data,id:this.getId()},e=this.config(),r=this.getStyle();return e&&(t.options=e),r&&(t.style=r),t},r.prototype.setStyle=function(t){return Array.isArray(t)||(t=[t]),this._style=t,this._cookedStyles=e.MapboxUtil.compileStyle(t),this.fire("setstyle",{style:t}),this},r.prototype.getStyle=function(){return this._style},r}(e.Layer);ie.mergeOptions(ne);var ae=X,oe=et,se=rt,le=ae,he=oe,ue=se,fe=it;at.prototype={range:function(t,e,r,n){return he(this.ids,this.coords,t,e,r,n,this.nodeSize)},within:function(t,e,r){return ue(this.ids,this.coords,t,e,r,this.nodeSize)}};var ce={blendEquation:"add"},pe=function(t){function e(){return Pt(this,e),Ut(this,t.apply(this,arguments))}return Lt(e,t),e.prototype.identify=function(t,e){var r=this._getRenderer();return r?r.identify(t,e):null},e}(ie);pe.mergeOptions(ce),pe.registerJSONType("BigPointLayer"),pe.registerRenderer("webgl",function(t){function r(e){Pt(this,r);var n=Ut(this,t.call(this,e));return n._needCheckStyle=!0,n._needCheckSprites=!0,n._registerEvents(),n}return Lt(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return[];var t=[];return this.layer.getStyle()&&this.layer.getStyle().forEach(function(r){var n=e.Util.getExternalResources(r.symbol,!0);n&&t.push(n)}),this._needCheckStyle=!1,this._needCheckSprites=!0,this._textureLoaded=!1,t},r.prototype.onCanvasCreate=function(){var t=this.gl;this._setBlendEquation();var e=["u_matrix","u_scale","u_sprite[0]"],r=this.createProgram(ee.point.vertexSource,ee.point.fragmentSource,e);this.useProgram(r);var n=this.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),this.enableVertexAttrib([["a_pos",2],["a_sprite_idx",1]])},r.prototype.draw=function(){if(this.prepareCanvas(),this._checkSprites(),!this._vertexCount){var t=this.getMap(),r=m(t),n=this.layer.data,i=[],a=[];this._vertexCount=0;for(var o=this.gl,s=[0,0],l=0,h=n.length;l<h;l++)if(n[l]){var u=void 0;if(Array.isArray(n[l]))u=n[l];else if(n[l].type){var f=this._getVertice(n[l]);u=[f[0],f[1],n[l].properties]}var c=this._getTexCoord({properties:u[2]});if(c){this._vertexCount++;var p=t.coordinateToPoint(new e.Coordinate(u),r);i.push(p.x,p.y,c.idx),a.push([p.x,p.y,c.size,c.offset,u]),c.size[0]>s[0]&&(s[0]=c.size[0]),c.size[1]>s[1]&&(s[1]=c.size[1])}}o.bufferData(o.ARRAY_BUFFER,new Float32Array(i),o.STATIC_DRAW),this._maxIconSize=s,this._indexData(a)}this._drawMarkers(),this.completeRender()},r.prototype.drawOnInteracting=function(){this._drawMarkers(),this.completeRender()},r.prototype.onRemove=function(){this._removeEvents(),delete this._sprites,delete this._uSprite,t.prototype.onRemove.apply(this,arguments)},r.prototype.identify=function(t,e){if(!this._kdIndex)return null;var r=this.getMap(),n=m(r),i=r.coordinateToPoint(t,n),a=r.getScale()/r.getScale(n),o=a*this._maxIconSize[0],s=a*this._maxIconSize[1];o<1&&(o=1),s<1&&(s=1);var l=this._kdIndex.range(i.x-o,i.y-s,i.x+o,i.y+s),h=void 0,u=void 0;e&&(e.filter&&(h=e.filter),e.count&&(u=e.count));for(var f=[],c=0,p=l.length;c<p;c++){var v=this._indexPoints[l[c]],y=v[0],g=v[1],d=v[2],_=v[3],x=[a*(-d[0]/2+_.x),a*(-d[1]/2+_.y),a*(d[0]/2+_.x),a*(d[1]/2+_.y)];if(i.x>=y+x[0]&&i.x<=y+x[2]&&i.y>=g+x[1]&&i.y<=g+x[3]&&(h&&!h(v[4])||f.push(v[4]),u&&f.length>=u))break}return f},r.prototype._indexData=function(t){this._indexPoints=t,this._kdIndex=fe(t,null,null,64,Int32Array)},r.prototype._getTexCoord=function(t){if(!this.layer._cookedStyles)return null;for(var e=0,r=this.layer._cookedStyles.length;e<r;e++)if(this.layer._cookedStyles[e].filter(t)===!0)return{idx:e,texCoord:this._sprites.texCoords[e],offset:this._sprites.offsets[e],size:this._sprites.sizes[e]};return null},r.prototype._checkSprites=function(){var t=this;if(this._needCheckSprites){var r=this.resources,n=[];if(this.layer.getStyle()&&!function(){var i=t.getMap();t.layer.getStyle().forEach(function(t){var a=new e.Marker([0,0],{symbol:t.symbol}),o=a._getSprite(r,i.CanvasClass);o&&n.push(o)})}(),this._sprites=this.mergeSprites(n,!0),this._sprites&&("undefined"!=typeof window&&window.MAPTALKS_WEBGL_DEBUG_CANVAS&&window.MAPTALKS_WEBGL_DEBUG_CANVAS.getContext("2d").drawImage(this._sprites.canvas,0,0),this._needCheckSprites=!1,!this._textureLoaded)){var i=this._sprites.canvas.getContext("2d"),a=this._sprites.canvas.width,o=this._sprites.canvas.height,s=i.getImageData(0,0,a,o);this.loadTexture(s),this.enableSampler("u_sampler"),this._textureLoaded=!0;for(var l=this._uSprite=[],h=0,u=this.layer._cookedStyles.length;h<u;h++)l.push.apply(l,this._sprites.texCoords[h]),l.push(this._sprites.offsets[h].x,this._sprites.offsets[h].y)}}},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._drawMarkers=function(){var t=this.gl,e=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,e),t.uniform1f(t.program.u_scale,this.getMap().getScale()),t.uniform1fv(t.program.u_sprite,this._uSprite),t.drawArrays(t.POINTS,0,this._vertexCount)},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r.prototype._setBlendEquation=function(){var t=this.layer.options.blendEquation;if(t){var e=this.gl;t=t.toLowerCase(),"add"===t?e.blendEquation(e.FUNC_ADD):"subtract"===t?e.blendEquation(e.FUNC_SUBTRACT):"reverse_substract"===t&&e.blendEquation(e.FUNC_REVERSE_SUBTRACT)}},r}(Ot));var ve=lt(function(t){var e=function(){function t(e,r,n,i){function o(e,n){if(null===e)return null;if(0==n)return e;var s,f;if("object"!=("undefined"==typeof e?"undefined":kt(e)))return e;if(t.__isArray(e))s=[];else if(t.__isRegExp(e))s=new RegExp(e.source,a(e)),e.lastIndex&&(s.lastIndex=e.lastIndex);else if(t.__isDate(e))s=new Date(e.getTime());else{if(u&&Buffer.isBuffer(e))return s=new Buffer(e.length),e.copy(s),s;"undefined"==typeof i?(f=Object.getPrototypeOf(e),s=Object.create(f)):(s=Object.create(i),f=i)}if(r){var c=l.indexOf(e);if(c!=-1)return h[c];l.push(e),h.push(s)}for(var p in e){var v;f&&(v=Object.getOwnPropertyDescriptor(f,p)),v&&null==v.set||(s[p]=o(e[p],n-1))}return s}var s;"object"===("undefined"==typeof r?"undefined":kt(r))&&(n=r.depth,i=r.prototype,s=r.filter,r=r.circular);var l=[],h=[],u="undefined"!=typeof Buffer;return"undefined"==typeof r&&(r=!0),"undefined"==typeof n&&(n=1/0),o(e,n)}function e(t){return Object.prototype.toString.call(t)}function r(t){return"object"===("undefined"==typeof t?"undefined":kt(t))&&"[object Date]"===e(t)}function n(t){return"object"===("undefined"==typeof t?"undefined":kt(t))&&"[object Array]"===e(t)}function i(t){return"object"===("undefined"==typeof t?"undefined":kt(t))&&"[object RegExp]"===e(t)}function a(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return t.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},t.__objToStr=e,t.__isDate=r,t.__isArray=n,t.__isRegExp=i,t.__getRegExpFlags=a,t}();t.exports&&(t.exports=e)}),ye={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},ge=lt(function(t){function e(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}var r=ye,n={};for(var i in r)r.hasOwnProperty(i)&&(n[r[i]]=i);var a=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var o in a)if(a.hasOwnProperty(o)){if(!("channels"in a[o]))throw new Error("missing channels property: "+o);if(!("labels"in a[o]))throw new Error("missing channel labels property: "+o);if(a[o].labels.length!==a[o].channels)throw new Error("channel and label counts mismatch: "+o);var s=a[o].channels,l=a[o].labels;delete a[o].channels,delete a[o].labels,Object.defineProperty(a[o],"channels",{value:s}),Object.defineProperty(a[o],"labels",{value:l})}a.rgb.hsl=function(t){var e,r,n,i=t[0]/255,a=t[1]/255,o=t[2]/255,s=Math.min(i,a,o),l=Math.max(i,a,o),h=l-s;return l===s?e=0:i===l?e=(a-o)/h:a===l?e=2+(o-i)/h:o===l&&(e=4+(i-a)/h),e=Math.min(60*e,360),e<0&&(e+=360),n=(s+l)/2,r=l===s?0:n<=.5?h/(l+s):h/(2-l-s),[e,100*r,100*n]},a.rgb.hsv=function(t){var e,r,n,i=t[0],a=t[1],o=t[2],s=Math.min(i,a,o),l=Math.max(i,a,o),h=l-s;return r=0===l?0:h/l*1e3/10,l===s?e=0:i===l?e=(a-o)/h:a===l?e=2+(o-i)/h:o===l&&(e=4+(i-a)/h),e=Math.min(60*e,360),e<0&&(e+=360),n=l/255*1e3/10,[e,r,n]},a.rgb.hwb=function(t){var e=t[0],r=t[1],n=t[2],i=a.rgb.hsl(t)[0],o=1/255*Math.min(e,Math.min(r,n));return n=1-1/255*Math.max(e,Math.max(r,n)),[i,100*o,100*n]},a.rgb.cmyk=function(t){var e,r,n,i,a=t[0]/255,o=t[1]/255,s=t[2]/255;return i=Math.min(1-a,1-o,1-s),e=(1-a-i)/(1-i)||0,r=(1-o-i)/(1-i)||0,n=(1-s-i)/(1-i)||0,[100*e,100*r,100*n,100*i]},a.rgb.keyword=function(t){var i=n[t];if(i)return i;var a,o=1/0;for(var s in r)if(r.hasOwnProperty(s)){var l=r[s],h=e(t,l);h<o&&(o=h,a=s)}return a},a.keyword.rgb=function(t){return r[t]},a.rgb.xyz=function(t){var e=t[0]/255,r=t[1]/255,n=t[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var i=.4124*e+.3576*r+.1805*n,a=.2126*e+.7152*r+.0722*n,o=.0193*e+.1192*r+.9505*n;return[100*i,100*a,100*o]},a.rgb.lab=function(t){var e,r,n,i=a.rgb.xyz(t),o=i[0],s=i[1],l=i[2];return o/=95.047,s/=100,l/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,e=116*s-16,r=500*(o-s),n=200*(s-l),[e,r,n]},a.hsl.rgb=function(t){var e,r,n,i,a,o=t[0]/360,s=t[1]/100,l=t[2]/100;if(0===s)return a=255*l,[a,a,a];r=l<.5?l*(1+s):l+s-l*s,e=2*l-r,i=[0,0,0];for(var h=0;h<3;h++)n=o+1/3*-(h-1),n<0&&n++,n>1&&n--,a=6*n<1?e+6*(r-e)*n:2*n<1?r:3*n<2?e+(r-e)*(2/3-n)*6:e,i[h]=255*a;return i},a.hsl.hsv=function(t){var e,r,n=t[0],i=t[1]/100,a=t[2]/100,o=i,s=Math.max(a,.01);return a*=2,i*=a<=1?a:2-a,o*=s<=1?s:2-s,r=(a+i)/2,e=0===a?2*o/(s+o):2*i/(a+i),[n,100*e,100*r]},a.hsv.rgb=function(t){var e=t[0]/60,r=t[1]/100,n=t[2]/100,i=Math.floor(e)%6,a=e-Math.floor(e),o=255*n*(1-r),s=255*n*(1-r*a),l=255*n*(1-r*(1-a));switch(n*=255,i){case 0:return[n,l,o];case 1:return[s,n,o];case 2:return[o,n,l];case 3:return[o,s,n];case 4:return[l,o,n];case 5:return[n,o,s]}},a.hsv.hsl=function(t){var e,r,n,i=t[0],a=t[1]/100,o=t[2]/100,s=Math.max(o,.01);return n=(2-a)*o,e=(2-a)*s,r=a*s,r/=e<=1?e:2-e,r=r||0,n/=2,[i,100*r,100*n]},a.hwb.rgb=function(t){var e,r,n,i,a=t[0]/360,o=t[1]/100,s=t[2]/100,l=o+s;l>1&&(o/=l,s/=l),e=Math.floor(6*a),r=1-s,n=6*a-e,0!==(1&e)&&(n=1-n),i=o+n*(r-o);var h,u,f;switch(e){default:case 6:case 0:h=r,u=i,f=o;break;case 1:h=i,u=r,f=o;break;case 2:h=o,u=r,f=i;break;case 3:h=o,u=i,f=r;break;case 4:h=i,u=o,f=r;break;case 5:h=r,u=o,f=i}return[255*h,255*u,255*f]},a.cmyk.rgb=function(t){var e,r,n,i=t[0]/100,a=t[1]/100,o=t[2]/100,s=t[3]/100;return e=1-Math.min(1,i*(1-s)+s),r=1-Math.min(1,a*(1-s)+s),n=1-Math.min(1,o*(1-s)+s),[255*e,255*r,255*n]},a.xyz.rgb=function(t){var e,r,n,i=t[0]/100,a=t[1]/100,o=t[2]/100;return e=3.2406*i+a*-1.5372+o*-.4986,r=i*-.9689+1.8758*a+.0415*o,n=.0557*i+a*-.204+1.057*o,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=Math.min(Math.max(0,e),1),r=Math.min(Math.max(0,r),1),n=Math.min(Math.max(0,n),1),[255*e,255*r,255*n]},a.xyz.lab=function(t){var e,r,n,i=t[0],a=t[1],o=t[2];return i/=95.047,a/=100,o/=108.883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,e=116*a-16,r=500*(i-a),n=200*(a-o),[e,r,n]},a.lab.xyz=function(t){var e,r,n,i=t[0],a=t[1],o=t[2];r=(i+16)/116,e=a/500+r,n=r-o/200;var s=Math.pow(r,3),l=Math.pow(e,3),h=Math.pow(n,3);return r=s>.008856?s:(r-16/116)/7.787,e=l>.008856?l:(e-16/116)/7.787,n=h>.008856?h:(n-16/116)/7.787,e*=95.047,r*=100,n*=108.883,[e,r,n]},a.lab.lch=function(t){var e,r,n,i=t[0],a=t[1],o=t[2];return e=Math.atan2(o,a),r=360*e/2/Math.PI,r<0&&(r+=360),n=Math.sqrt(a*a+o*o),[i,n,r]},a.lch.lab=function(t){var e,r,n,i=t[0],a=t[1],o=t[2];return n=o/360*2*Math.PI,e=a*Math.cos(n),r=a*Math.sin(n),[i,e,r]},a.rgb.ansi16=function(t){var e=t[0],r=t[1],n=t[2],i=1 in arguments?arguments[1]:a.rgb.hsv(t)[2];if(i=Math.round(i/50),0===i)return 30;var o=30+(Math.round(n/255)<<2|Math.round(r/255)<<1|Math.round(e/255));return 2===i&&(o+=60),o},a.hsv.ansi16=function(t){return a.rgb.ansi16(a.hsv.rgb(t),t[2])},a.rgb.ansi256=function(t){var e=t[0],r=t[1],n=t[2];if(e===r&&r===n)return e<8?16:e>248?231:Math.round((e-8)/247*24)+232;var i=16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(n/255*5);return i},a.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];var r=.5*(~~(t>50)+1),n=(1&e)*r*255,i=(e>>1&1)*r*255,a=(e>>2&1)*r*255;return[n,i,a]},a.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}t-=16;var r,n=Math.floor(t/36)/5*255,i=Math.floor((r=t%36)/6)/5*255,a=r%6/5*255;return[n,i,a]},a.rgb.hex=function(t){var e=((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2])),r=e.toString(16).toUpperCase();return"000000".substring(r.length)+r},a.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}/i);if(!e)return[0,0,0];var r=parseInt(e[0],16),n=r>>16&255,i=r>>8&255,a=255&r;return[n,i,a]},a.rgb.hcg=function(t){var e,r,n=t[0]/255,i=t[1]/255,a=t[2]/255,o=Math.max(Math.max(n,i),a),s=Math.min(Math.min(n,i),a),l=o-s;return e=l<1?s/(1-l):0,r=l<=0?0:o===n?(i-a)/l%6:o===i?2+(a-n)/l:4+(n-i)/l+4,r/=6,r%=1,[360*r,100*l,100*e]},a.hsl.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=1,i=0;return n=r<.5?2*e*r:2*e*(1-r),n<1&&(i=(r-.5*n)/(1-n)),[t[0],100*n,100*i]},a.hsv.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=e*r,i=0;return n<1&&(i=(r-n)/(1-n)),[t[0],100*n,100*i]},a.hcg.rgb=function(t){var e=t[0]/360,r=t[1]/100,n=t[2]/100;if(0===r)return[255*n,255*n,255*n];var i=[0,0,0],a=e%1*6,o=a%1,s=1-o,l=0;switch(Math.floor(a)){case 0:i[0]=1,i[1]=o,i[2]=0;break;case 1:i[0]=s,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=o;break;case 3:i[0]=0,i[1]=s,i[2]=1;break;case 4:i[0]=o,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=s}return l=(1-r)*n,[255*(r*i[0]+l),255*(r*i[1]+l),255*(r*i[2]+l)]},a.hcg.hsv=function(t){var e=t[1]/100,r=t[2]/100,n=e+r*(1-e),i=0;return n>0&&(i=e/n),[t[0],100*i,100*n]},a.hcg.hsl=function(t){var e=t[1]/100,r=t[2]/100,n=r*(1-e)+.5*e,i=0;return n>0&&n<.5?i=e/(2*n):n>=.5&&n<1&&(i=e/(2*(1-n))),[t[0],100*i,100*n]},a.hcg.hwb=function(t){var e=t[1]/100,r=t[2]/100,n=e+r*(1-e);return[t[0],100*(n-e),100*(1-n)]},a.hwb.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=1-r,i=n-e,a=0;return i<1&&(a=(n-i)/(1-i)),[t[0],100*i,100*a]},a.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},a.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},a.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},a.gray.hsl=a.gray.hsv=function(t){return[0,0,t[0]]},a.gray.hwb=function(t){return[0,100,t[0]]},a.gray.cmyk=function(t){return[0,0,0,t[0]]},a.gray.lab=function(t){return[t[0],0,0]},a.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),r=(e<<16)+(e<<8)+e,n=r.toString(16).toUpperCase();return"000000".substring(n.length)+n},a.rgb.gray=function(t){var e=(t[0]+t[1]+t[2])/3;return[e/255*100]}}),de=ge,_e=Object.keys(de),xe=function(t){for(var e=ut(t),r={},n=Object.keys(e),i=n.length,a=0;a<i;a++){var o=n[a],s=e[o];null!==s.parent&&(r[o]=ct(o,e))}return r},me=ge,be=xe,Ae={},we=Object.keys(me);we.forEach(function(t){Ae[t]={},Object.defineProperty(Ae[t],"channels",{value:me[t].channels}),Object.defineProperty(Ae[t],"labels",{value:me[t].labels});var e=be(t),r=Object.keys(e);r.forEach(function(r){var n=e[r];Ae[t][r]=vt(n),Ae[t][r].raw=pt(n)})});var Se=Ae,Ee=ye,Me={getRgba:yt,getHsla:gt,getRgb:_t,getHsl:xt,getHwb:dt,getAlpha:mt,hexString:bt,rgbString:At,rgbaString:wt,percentString:St,percentaString:Et,hslString:Mt,hslaString:Rt,hwbString:Ct,keyword:Bt},Re={};for(var Ce in Ee)Re[Ee[Ce]]=Ce;var Be=ve,Fe=Se,Te=Me,ke=function t(e){if(e instanceof t)return e;if(!(this instanceof t))return new t(e);this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1};var r;if("string"==typeof e)if(r=Te.getRgba(e))this.setValues("rgb",r);else if(r=Te.getHsla(e))this.setValues("hsl",r);else{if(!(r=Te.getHwb(e)))throw new Error('Unable to parse color from string "'+e+'"');this.setValues("hwb",r)}else if("object"===("undefined"==typeof e?"undefined":kt(e)))if(r=e,void 0!==r.r||void 0!==r.red)this.setValues("rgb",r);else if(void 0!==r.l||void 0!==r.lightness)this.setValues("hsl",r);else if(void 0!==r.v||void 0!==r.value)this.setValues("hsv",r);else if(void 0!==r.w||void 0!==r.whiteness)this.setValues("hwb",r);else{if(void 0===r.c&&void 0===r.cyan)throw new Error("Unable to parse color from object "+JSON.stringify(e));this.setValues("cmyk",r)}};ke.prototype={rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){return 1!==this.values.alpha?this.values.hwb.concat([this.values.alpha]):this.values.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){var t=this.values.rgb;return t.concat([this.values.alpha])},rgbaArrayNormalized:function(){for(var t=this.values.rgb,e=[],r=0;r<3;r++)e[r]=t[r]/255;return e.push(this.values.alpha),e},hslaArray:function(){var t=this.values.hsl;return t.concat([this.values.alpha])},alpha:function(t){return void 0===t?this.values.alpha:(this.setValues("alpha",t),this)},red:function(t){return this.setChannel("rgb",0,t)},green:function(t){return this.setChannel("rgb",1,t)},blue:function(t){return this.setChannel("rgb",2,t)},hue:function(t){return t&&(t%=360,t=t<0?360+t:t),this.setChannel("hsl",0,t)},saturation:function(t){return this.setChannel("hsl",1,t)},lightness:function(t){return this.setChannel("hsl",2,t)},saturationv:function(t){return this.setChannel("hsv",1,t)},whiteness:function(t){return this.setChannel("hwb",1,t)},blackness:function(t){return this.setChannel("hwb",2,t)},value:function(t){return this.setChannel("hsv",2,t)},cyan:function(t){return this.setChannel("cmyk",0,t)},magenta:function(t){return this.setChannel("cmyk",1,t)},yellow:function(t){return this.setChannel("cmyk",2,t)},black:function(t){return this.setChannel("cmyk",3,t)},hexString:function(){return Te.hexString(this.values.rgb)},rgbString:function(){return Te.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return Te.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return Te.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return Te.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return Te.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return Te.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return Te.keyword(this.values.rgb,this.values.alpha)},rgbNumber:function(){return this.values.rgb[0]<<16|this.values.rgb[1]<<8|this.values.rgb[2]},luminosity:function(){for(var t=this.values.rgb,e=[],r=0;r<t.length;r++){var n=t[r]/255;e[r]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),r=t.luminosity();return e>r?(e+.05)/(r+.05):(r+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},dark:function(){var t=this.values.rgb,e=(299*t[0]+587*t[1]+114*t[2])/1e3;return e<128},light:function(){return!this.dark()},negate:function(){for(var t=[],e=0;e<3;e++)t[e]=255-this.values.rgb[e];return this.setValues("rgb",t),this},lighten:function(t){return this.values.hsl[2]+=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},darken:function(t){return this.values.hsl[2]-=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},saturate:function(t){return this.values.hsl[1]+=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},desaturate:function(t){return this.values.hsl[1]-=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},whiten:function(t){return this.values.hwb[1]+=this.values.hwb[1]*t,this.setValues("hwb",this.values.hwb),this},blacken:function(t){return this.values.hwb[2]+=this.values.hwb[2]*t,this.setValues("hwb",this.values.hwb),this},greyscale:function(){var t=this.values.rgb,e=.3*t[0]+.59*t[1]+.11*t[2];return this.setValues("rgb",[e,e,e]),this},clearer:function(t){return this.setValues("alpha",this.values.alpha-this.values.alpha*t),this},opaquer:function(t){return this.setValues("alpha",this.values.alpha+this.values.alpha*t),this},rotate:function(t){var e=this.values.hsl[0];return e=(e+t)%360,e=e<0?360+e:e,this.values.hsl[0]=e,this.setValues("hsl",this.values.hsl),this},mix:function(t,e){var r=this,n=t,i=void 0===e?.5:e,a=2*i-1,o=r.alpha()-n.alpha(),s=((a*o===-1?a:(a+o)/(1+a*o))+1)/2,l=1-s;return this.rgb(s*r.red()+l*n.red(),s*r.green()+l*n.green(),s*r.blue()+l*n.blue()).alpha(r.alpha()*i+n.alpha()*(1-i))},toJSON:function(){return this.rgb()},clone:function(){var t=new ke;return t.values=Be(this.values),t}},ke.prototype.getValues=function(t){for(var e={},r=0;r<t.length;r++)e[t.charAt(r)]=this.values[t][r];return 1!==this.values.alpha&&(e.a=this.values.alpha),e},ke.prototype.setValues=function(t,e){var r,n={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},i={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},a=1;if("alpha"===t)a=e;else if(e.length)this.values[t]=e.slice(0,t.length),a=e[t.length];else if(void 0!==e[t.charAt(0)]){for(r=0;r<t.length;r++)this.values[t][r]=e[t.charAt(r)];a=e.a}else if(void 0!==e[n[t][0]]){var o=n[t];for(r=0;r<t.length;r++)this.values[t][r]=e[o[r]];a=e.alpha}if(this.values.alpha=Math.max(0,Math.min(1,void 0===a?this.values.alpha:a)),"alpha"===t)return!1;var s;for(r=0;r<t.length;r++)s=Math.max(0,Math.min(i[t][r],this.values[t][r])),this.values[t][r]=Math.round(s);for(var l in n)for(l!==t&&(this.values[l]=Fe[t][l](this.values[t])),r=0;r<l.length;r++)s=Math.max(0,Math.min(i[l][r],this.values[l][r])),this.values[l][r]=Math.round(s);return!0},ke.prototype.setSpace=function(t,e){var r=e[0];return void 0===r?this.getValues(t):("number"==typeof r&&(r=Array.prototype.slice.call(e)),this.setValues(t,r),this)},ke.prototype.setChannel=function(t,e,r){return void 0===r?this.values[t][e]:r===this.values[t][e]?this:(this.values[t][e]=r,this.setValues(t,this.values[t]),this)};var Pe=ke,Le=function(t){function r(e){Pt(this,r);var n=Ut(this,t.call(this,e));return n._needCheckStyle=!0,n._needCheckSprites=!0,n._registerEvents(),n}return Lt(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return[];var t=[];return this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(r){r.symbol=e.Util.convertResourceUrl(r.symbol);var n=e.Util.getExternalResources(r.symbol,!0);n&&t.push(n)}),this._needCheckStyle=!1,this._needCheckSprites=!0,this._textureLoaded=!1,0===t.length?[]:t},r.prototype.onCanvasCreate=function(){this.gl.getExtension("OES_element_index_uint")},r.prototype.onRemove=function(){this._removeEvents(),delete this._fillSprites,delete this._sprites,t.prototype.onRemove.apply(this,arguments)},r.prototype.getDataSymbol=function(t){for(var e=-1,r=0,n=this.layer._cookedStyles.length;r<n;r++){var i=this.layer._cookedStyles[r],a=this.getTexture(i.symbol);if(a&&e++,i.filter({properties:t})===!0)return a?{symbol:i.symbol,texCoord:this._fillSprites.texCoords[e],index:r}:{symbol:i.symbol,index:r}}return null},r.prototype.getLineTexture=function(t){return this._atlas.getAtlas(t)},r.prototype.getFillTexture=function(t){var e=t?t.polygonPatternFile:null;return e?this.resources.getImage(e):null},r.prototype._checkSprites=function(){var t=this;if(this._needCheckSprites){this._atlas=new It(this.resources);var r=[],n=[];if(this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(i){var a=t.getLineTexture(i.symbol);a&&r.push(a),a=t.getFillTexture(i.symbol),a&&n.push({canvas:a,offset:new e.Point(0,0)})}),this._sprites=this.mergeSprites(r),this._fillSprites=this.mergeSprites(n),this._sprites&&"undefined"!=typeof window&&window.MAPTALKS_WEBGL_DEBUG_CANVAS){var i=window.MAPTALKS_WEBGL_DEBUG_CANVAS;i.getContext("2d").fillRect(0,0,i.width,i.height),i.getContext("2d").fillStyle="rgb(255, 255, 255)",i.getContext("2d").fillRect(0,0,this._sprites.canvas.width,this._sprites.canvas.height),i.getContext("2d").drawImage(this._sprites.canvas,0,0)}this._needCheckSprites=!1,this._sprites&&!this._textureLoaded&&(this.loadTexture(this._sprites.canvas),this.enableSampler("u_image"),this._textureLoaded=!0),this._fillSprites&&!this._fillTextureLoaded&&(this.loadTexture(this._fillSprites.canvas),this.enableSampler("u_fill_image"),this._fillTextureLoaded=!0);for(var a=0,o=this._uStyle=[],s=0,l=this.layer._cookedStyles.length;s<l;s++){var h=this.layer._cookedStyles[s],u=this.getLineTexture(h.symbol);if(u)o.push.apply(o,this._sprites.texCoords[a++]),o.push(-1);else{var f=h.symbol.lineColor||"#000000";f=Pe(f).rgbaArrayNormalized(),o.push.apply(o,f)}}a=0;for(var c=this._uFillStyle=[],p=0,v=this.layer._cookedStyles.length;p<v;p++){var y=this.layer._cookedStyles[p],g=this.getFillTexture(y.symbol);if(g)c.push.apply(c,this._fillSprites.texCoords[a++]),c.push(-1);else{var d=y.symbol.polygonFill||"#fff";d=Pe(d).rgbaArrayNormalized(),c.push.apply(c,d)}}}},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r}(Ot),Ue={blur:2},De=function(t){function e(){return Pt(this,e),Ut(this,t.apply(this,arguments))}return Lt(e,t),e}(ie);De.mergeOptions(Ue),De.registerJSONType("BigLineLayer");var Ne=function(t){function e(){return Pt(this,e),Ut(this,t.apply(this,arguments))}return Lt(e,t),e.prototype.onCanvasCreate=function(){var e=["u_matrix","u_scale","u_tex_size","u_styles[0]"];this._lineProgram=this.createProgram(ee.line.vertexSource,ee.line.fragmentSource,e),t.prototype.onCanvasCreate.call(this)},e.prototype.draw=function(){this.prepareCanvas(),this._drawLines(),this.completeRender()},e.prototype.drawOnInteracting=function(){this._drawLines(),this.completeRender()},e.prototype.onRemove=function(){delete this._lineArrays,t.prototype.onRemove.apply(this,arguments)},e.prototype.getTexture=function(t){return this.getLineTexture(t)},e.prototype._drawLines=function(){var t=this.gl,e=this.getMap(),r=this._lineProgram;this.useProgram(r),this._checkSprites(),this._prepareLineData(),this._bufferLineData(this._lineArrays);var n=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,n),t.uniform1f(r.u_scale,e.getScale()/e.getScale(m(e))),t.uniform1fv(r.u_styles,this._uStyle);var i=[0,0];this._sprites&&(i=[this._sprites.canvas.width,this._sprites.canvas.height]),t.uniform2fv(r.u_tex_size,new Float32Array(i)),t.drawElements(t.TRIANGLES,this._elementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._prepareLineData=function(){if(!this._lineArrays){for(var t=this.gl,e=this.getMap(),r=this.layer.data,n=new jt(t,e),i=void 0,a=0,o=r.length;a<o;a++)r[a]&&(Array.isArray(r[a])?(i=this.getDataSymbol(r[a][1]),
n.addLine(r[a][0],i)):r[a].type&&(i=this.getDataSymbol(r[a].properties),n.addLine(r[a],i)));var s=this._lineArrays=n.getArrays();this._elementCount=s.elementArray.length}},e.prototype._bufferLineData=function(t){var e=this.gl;if(this._vertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);else{var r=this._vertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",2,"FLOAT"]),this._normalBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer);else{var n=this._normalBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.normalArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_normal",2,"FLOAT"],["a_linesofar",1,"FLOAT"]]),this._texBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._texBuffer);else{var i=this._texBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._elementBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._elementBuffer);else{var a=this._elementBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e}(Le);De.registerRenderer("webgl",Ne);var Oe={blur:2},Ie=function(t){function e(){return Pt(this,e),Ut(this,t.apply(this,arguments))}return Lt(e,t),e}(ie);Ie.mergeOptions(Oe),Ie.registerJSONType("BigPolygonLayer"),Ie.registerRenderer("webgl",function(t){function e(){return Pt(this,e),Ut(this,t.apply(this,arguments))}return Lt(e,t),e.prototype.onCanvasCreate=function(){var e=["u_matrix","u_fill_styles[0]"];this._polygonProgram=this.createProgram(ee.polygon.vertexSource,ee.polygon.fragmentSource,e),t.prototype.onCanvasCreate.call(this)},e.prototype.draw=function(){this.prepareCanvas(),this._drawPolygons(),this.gl.disable(this.gl.BLEND),this._drawLines(),this.gl.enable(this.gl.BLEND),this.completeRender()},e.prototype.drawOnInteracting=function(){this._drawPolygons(),this.gl.disable(this.gl.BLEND),this._drawLines(),this.gl.enable(this.gl.BLEND),this.completeRender()},e.prototype.getTexture=function(t){return this.getFillTexture(t)},e.prototype._drawPolygons=function(){var t=this.gl,e=this._polygonProgram;this.useProgram(e),this._checkSprites(),this._preparePolygonData(),this._bufferPolygonData(this._polygonArrays);var r=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,r),t.uniform1fv(e.u_fill_styles,this._uFillStyle),t.drawElements(t.TRIANGLES,this._polygonElementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._preparePolygonData=function(){if(!this._polygonArrays){for(var t=this.gl,e=this.getMap(),r=this.layer.data,n=new qt(t,e),i=void 0,a=0,o=r.length;a<o;a++)r[a]&&(Array.isArray(r[a])?(i=this.getDataSymbol(r[a][1]),n.addPolygon(r[a][0],i)):r[a].type&&(i=this.getDataSymbol(r[a].properties),n.addPolygon(r[a],i)));var s=this._polygonArrays=n.getArrays();this._polygonElementCount=s.elementArray.length}},e.prototype._bufferPolygonData=function(t){var e=this.gl;if(this._polygonVertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._polygonVertexBuffer);else{var r=this._polygonVertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",2,"FLOAT"]),this._polygonTexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._polygonTexBuffer);else{var n=this._polygonTexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_fill_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._polygonElemBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._polygonElemBuffer);else{var i=this._polygonElemBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e.prototype.onRemove=function(){delete this._polygonArrays,t.prototype.onRemove.apply(this,arguments)},e}(Ne));var Ve={project:!0},ze=function(t){function r(e,n,i){Pt(this,r);var a=Ut(this,t.call(this,e,n,i));return a.vertexArray=[],a.normalArray=[],a.elementArray=[],a.styleArray=[],a}return Lt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,normalArray:this.normalArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addPolygon=function(t,e,r){if(!t)return this;if(r.symbol.polygonOpacity<=0)return this;var n=this._getVertice(t);if(n[0]&&Array.isArray(n[0][0])&&Array.isArray(n[0][0][0])){for(var i=0,a=n.length;i<a;i++)this.addPolygon(n[i],e,r);return this}return this._fillArrays(n,e,r),this},r.prototype._fillArrays=function(t,r,n){for(var i=3,a=m(this.map),o=Yt.flatten(t),s=[],l=[],h=void 0,u=0,f=o.vertices.length;u<f;u+=2)u===f-1&&this._equalCoord(o.vertices[u],o.vertices[0])||(this.options.project?(h=this.map.coordinateToPoint(new e.Coordinate(o.vertices[u],o.vertices[u+1]),a),s.push(h.x,h.y,0),l.push(h.x,h.y,r)):(s.push(o.vertices[u],o.vertices[u+1],0),l.push(o.vertices[u],o.vertices[u+1],r)));o.vertices=s;var c=Yt(o.vertices,o.holes,i);if(!(c.length<=2)){var p=Yt.deviation(o.vertices,o.holes,i,c);if(Math.round(1e3*p)/1e3!==0)return void(console&&console.warn("Failed triangluation."));var v=s.length/i,y=this.vertexArray.length/i;y>0&&(c=c.map(function(t){return t+y})),e.Util.pushIn(this.vertexArray,s),e.Util.pushIn(this.elementArray,c);for(var g=0;g<v;g++)this.normalArray.push(0,0,-1);v>0&&(c=c.map(function(t){return t+v})),e.Util.pushIn(this.vertexArray,l),e.Util.pushIn(this.elementArray,c);for(var d=0;d<v;d++)this.normalArray.push(0,0,1);for(var _=this.vertexArray.length/i,x=0,b=v;x<b-1;x++){var A=x*i,w=new Vt(s[A+3],s[A+4]).sub(new Vt(s[A],s[A+1]))._unit()._perp();this.vertexArray.push(s[A],s[A+1],s[A+2]),this.vertexArray.push(s[A+3],s[A+4],s[A+5]),this.vertexArray.push(l[A+3],l[A+4],l[A+5]),this.vertexArray.push(l[A],l[A+1],l[A+2]);for(var S=0;S<4;S++)this.normalArray.push(w.x,w.y,0);var E=4*x;this.elementArray.push(_+E,_+E+1,_+E+2),this.elementArray.push(_+E,_+E+2,_+E+3)}this._addTexCoords(this.vertexArray.length/i-y,n)}},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){for(var r=100*e.index+10*(e.symbol.polygonOpacity||1),n=0;n<t;n++)this.styleArray.push(r)},r.prototype._equalCoord=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r}(Dt);ze.mergeOptions(Ve);var je={lightPos:[10,0,35],lightColor:[1,1,1],lightIntensity:.5,ambientLight:[.02,.02,.02]},Ye=function(t){function e(){return Pt(this,e),Ut(this,t.apply(this,arguments))}return Lt(e,t),e}(ie);Ye.mergeOptions(je),Ye.registerJSONType("ExtrudePolygonLayer");var Ze=function(t){function e(){return Pt(this,e),Ut(this,t.apply(this,arguments))}return Lt(e,t),e.prototype.onCanvasCreate=function(){var e=["u_matrix","u_fill_styles[0]","u_lightcolor","u_lightpos","u_ambientlight","u_lightintensity"];this.program=this.createProgram(ee.extrude.vertexSource,ee.extrude.fragmentSource,e),t.prototype.onCanvasCreate.call(this);var r=this.gl;r.enable(r.DEPTH_TEST),r.disable(r.BLEND),r.disable(r.STENCIL_TEST),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)},e.prototype.draw=function(){this.prepareCanvas(),this._drawExtrudes(),this.completeRender()},e.prototype.drawOnInteracting=function(){this._drawExtrudes(),this.completeRender()},e.prototype.onRemove=function(){delete this._extrudeArrays,t.prototype.onRemove.apply(this,arguments)},e.prototype.getTexture=function(t){return this.getFillTexture(t)},e.prototype._drawExtrudes=function(){var t=this.gl,e=this.program;this.useProgram(e),this._checkSprites(),this._prepareData();var r=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,r),t.uniform1fv(e.u_fill_styles,this._uFillStyle);var n=this.layer.options.lightPos||[0,0,35];t.uniform3fv(t.program.u_lightpos,y([],n));var i=this.layer.options.lightColor||[1,1,1];t.uniform3f(t.program.u_lightcolor,i[0],i[1],i[2]);var a=this.layer.options.ambientLight||[.02,.02,.02];t.uniform3f(t.program.u_ambientlight,a[0],a[1],a[2]);var o=this.layer.options.lightIntensity||.5;t.uniform1f(t.program.u_lightintensity,o),this._bufferExtrudeData(this._extrudeArrays),t.drawElements(t.TRIANGLES,this._elementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._prepareData=function(){if(!this._extrudeArrays){for(var t=this.gl,e=this.getMap(),r=m(e),n=this.layer.data,i=new ze(t,e),a=0,o=n.length;a<o;a++)if(n[a])if(Array.isArray(n[a])){var s=this.getDataSymbol(n[a][1]),l=n[a][1].height,h=e.distanceToPixel(l,0,r).width;i.addPolygon(n[a][0],h,s)}else if(n[a].type){var u=this.getDataSymbol(n[a].properties),f=n[a].properties.height,c=e.distanceToPixel(f,0,r).width;i.addPolygon(n[a],c,u)}var p=this._extrudeArrays=i.getArrays();this._elementCount=p.elementArray.length}},e.prototype._bufferExtrudeData=function(t){var e=this.gl;if(this._vertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);else{var r=this._vertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",3,"FLOAT"]),this._normalBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer);else{var n=this._normalBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.normalArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_normal",3,"FLOAT"]),this._texBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._texBuffer);else{var i=this._texBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_fill_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._elementBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._elementBuffer);else{var a=this._elementBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e}(Le);Ye.registerRenderer("webgl",Ze),t.webgl=re,t.BigDataLayer=ie,t.BigPointLayer=pe,t.BigLineLayer=De,t.BigPolygonLayer=Ie,t.ExtrudePolygonLayer=Ye,Object.defineProperty(t,"__esModule",{value:!0})});